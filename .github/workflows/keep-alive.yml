name: Keep Streamlit App Alive

on:
  schedule:
    - cron: '30 5 * * 1-5'
  workflow_dispatch:

jobs:
  ping-app:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping with wget
        run: |
          echo "ğŸš€ Streamlit Keep-Alive"
          echo "â° $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo ""
          
          URL="${{ secrets.STREAMLIT_APP_URL }}?health=check"
          
          echo "ğŸ“¡ Ping 1: Wake up (timeout 3 min)..."
          wget -qO- --timeout=180 "$URL" 2>&1 || echo "(no response)"
          echo ""
          
          sleep 10
          
          echo "ğŸ“¡ Ping 2: Verify..."
          RESULT=$(wget -qO- --timeout=30 "$URL" 2>&1) || RESULT="ERROR"
          echo "Response: [$RESULT]"
          echo ""
          
          if [ "$RESULT" = "OK" ]; then
            echo "âœ… SUCCESS!"
          else
            echo "âš ï¸ Got: $RESULT"
            
            # Debug - sprawdÅº co zwraca gÅ‚Ã³wna strona
            echo ""
            echo "ğŸ” Debug - main page:"
            wget -qO- --timeout=30 "${{ secrets.STREAMLIT_APP_URL }}" 2>&1 | head -5
          fi